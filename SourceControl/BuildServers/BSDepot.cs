using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace SourceControl.BuildServers
{
    public class BSDepot
    {
        public Dictionary<string, BuildServers.IBuildServer> BuildServersRegister;
        public BSDepot()
        {
            BuildServersRegister = new Dictionary<string, BuildServers.IBuildServer>();

            //
            SourceControl.BuildServers.TeamCityBS tc = new BuildServers.TeamCityBS();
            BuildServersRegister.Add(tc.Name, tc);

            //
            if (TaskUniversum.Common.Runtime.IsRunningOnMono())
            {
                SourceControl.BuildServers.NaiveXBuildfromGit monogit = new BuildServers.NaiveXBuildfromGit();
                BuildServersRegister.Add(monogit.Name, monogit);
            }
            else
            {
                SourceControl.BuildServers.NaiveMSfromGit netgit = new BuildServers.NaiveMSfromGit();
                BuildServersRegister.Add(netgit.Name, netgit);
            }

            //
            SourceControl.BuildServers.LocalDirectory localDir = new BuildServers.LocalDirectory();
            BuildServersRegister.Add(localDir.Name, localDir);
        }

        public TaskQueue.Providers.TItemModel GetParametersModel(string buildServerType)
        {
            return BuildServersRegister[buildServerType].GetParametersModel();
        }
        public BuildServers.IBuildServer GetNewInstance(string buildServerType)
        {
            BuildServers.IBuildServer dicbs;
            if (BuildServersRegister.TryGetValue(buildServerType, out dicbs))
            {
                Type t = dicbs.GetType();
                object obj = Activator.CreateInstance(t);
                return obj as BuildServers.IBuildServer;
            }
            return null;
        }
    }
}
